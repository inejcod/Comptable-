<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المحاسب الذكي - Le Comptable Intelligent</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #121212;
            color: #f0f0f0;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: #007bff;
            color: #fff;
        }
        .button-group button {
            padding: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .button-group button:hover {
            background-color: #555;
        }
        .form-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #ffffff;
        }
        .dark-mode .form-container {
            background-color: #1e1e1e;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            padding: 10px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #transactionsTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        #transactionsTable th, #transactionsTable td {
            border: 1px solid #ccc;
            padding: 10px;
        }
        #transactionsTable th {
            background-color: #007bff;
            color: #fff;
        }
        .total-amount {
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="header">
    <div id="title-card">المحاسب الذكي - Le Comptable Intelligent</div>
    <div class="button-group">
        <button onclick="toggleLanguage()">تغيير اللغة</button>
        <button onclick="toggleDarkMode()">الوضع الليلي/الساطع</button>
        <button onclick="downloadTransactions('json')">تنزيل JSON</button>
        <button onclick="downloadTransactions('csv')">تنزيل CSV</button>
        <button onclick="showSummary()">ملخص المعاملات</button>
    </div>
</div>

<div class="form-container">
    <div class="form-group">
        <label for="clientName">اسم العميل:</label>
        <input type="text" id="clientName" required>
    </div>
    <div class="form-group">
        <label for="phoneNumber">رقم الهاتف:</label>
        <input type="tel" id="phoneNumber" required>
    </div>
    <div class="form-group">
        <label for="transactionDate">تاريخ المعاملة:</label>
        <input type="date" id="transactionDate" required>
    </div>
    <div class="form-group">
        <label for="amountPaid">المبلغ المدفوع:</label>
        <input type="number" id="amountPaid" required>
    </div>
    <div class="form-group">
        <label for="remainingBalance">الرصيد المتبقي:</label>
        <input type="number" id="remainingBalance" required>
    </div>
    <button onclick="addTransaction()">إضافة معاملة</button>

    <table id="transactionsTable">
        <thead>
            <tr>
                <th>رمز التعريف</th>
                <th>اسم العميل</th>
                <th>رقم الهاتف</th>
                <th>تاريخ المعاملة</th>
                <th>المبلغ المدفوع</th>
                <th>الرصيد المتبقي</th>
            </tr>
        </thead>
        <tbody id="transactionsBody">
        </tbody>
    </table>
    <div class="total-amount" id="totalAmount">إجمالي المبالغ المدفوعة: 0</div>
</div>

<script>
    // Initialize data from localStorage
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let darkMode = JSON.parse(localStorage.getItem('darkMode')) || false;
    let language = localStorage.getItem('language') || 'ar';

    // Apply initial settings
    document.body.className = darkMode ? 'dark-mode' : 'light-mode';
    updateLanguage();

    function addTransaction() {
        const clientName = document.getElementById('clientName').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const transactionDate = document.getElementById('transactionDate').value;
        const amountPaid = parseFloat(document.getElementById('amountPaid').value);
        const remainingBalance = parseFloat(document.getElementById('remainingBalance').value);

        if (!clientName || !phoneNumber || !transactionDate || isNaN(amountPaid) || isNaN(remainingBalance)) {
            alert('الرجاء إدخال جميع المعلومات لإكمال المعاملة.');
            return;
        }

        const uniqueId = 'ID' + Math.random().toString(36).substr(2, 9);

        const transaction = { uniqueId, clientName, phoneNumber, transactionDate, amountPaid, remainingBalance };

        transactions.push(transaction);
        saveTransactions();
        displayTransactions();
        clearFields();
        updateTotalAmount();
    }

    function saveTransactions() {
        localStorage.setItem('transactions', JSON.stringify(transactions));
    }

    function displayTransactions() {
        const tbody = document.getElementById('transactionsBody');
        tbody.innerHTML = '';
        transactions.forEach(transaction => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${transaction.uniqueId}</td>
                <td>${transaction.clientName}</td>
                <td>${transaction.phoneNumber}</td>
                <td>${transaction.transactionDate}</td>
                <td>${transaction.amountPaid}</td>
                <td>${transaction.remainingBalance}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function clearFields() {
        document.getElementById('clientName').value = '';
        document.getElementById('phoneNumber').value = '';
        document.getElementById('transactionDate').value = '';
        document.getElementById('amountPaid').value = '';
        document.getElementById('remainingBalance').value = '';
    }

    function toggleDarkMode() {
        darkMode = !darkMode;
        localStorage.setItem('darkMode', JSON.stringify(darkMode));
        document.body.className = darkMode ? 'dark-mode' : 'light-mode';
    }

    function toggleLanguage() {
        language = language === 'ar' ? 'fr' : 'ar';
        localStorage.setItem('language', language);
        updateLanguage();
    }

    function updateLanguage() {
        document.getElementById('title-card').innerText = language === 'ar' ? 'المحاسب الذكي' : 'Le Comptable Intelligent';
        document.querySelectorAll('label').forEach(label => {
            const translations = {
                'اسم العميل:': language === 'ar' ? 'اسم العميل:' : 'Nom du client:',
                'رقم الهاتف:': language === 'ar' ? 'رقم الهاتف:' : 'Numéro de téléphone:',
                'تاريخ المعاملة:': language === 'ar' ? 'تاريخ المعاملة:' : 'Date de transaction:',
                'المبلغ المدفوع:': language === 'ar' ? 'المبلغ المدفوع:' : 'Montant payé:',
                'الرصيد المتبقي:': language === 'ar' ? 'الرصيد المتبقي:' : 'Solde restant:'
            };
            label.innerText = translations[label.innerText] || label.innerText;
        });
    }

    function downloadTransactions(format) {
        if (transactions.length === 0) {
            alert('لا توجد معاملات لتنزيلها.');
            return;
        }

        let data, fileName, mimeType;

        if (format === 'json') {
            data = JSON.stringify(transactions, null, 2);
            fileName = 'transactions.json';
            mimeType = 'application/json';
        } else if (format === 'csv') {
            const headers = Object.keys(transactions[0]).join(',');
            const rows = transactions.map(t => Object.values(t).join(',')).join('\n');
            data = `${headers}\n${rows}`;
            fileName = 'transactions.csv';
            mimeType = 'text/csv';
        }

        const blob = new Blob([data], { type: mimeType });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        link.click();
    }

    function showSummary() {
        const totalTransactions = transactions.length;
        const totalPaid = transactions.reduce((sum, t) => sum + t.amountPaid, 0);
        alert(`إجمالي عدد المعاملات: ${totalTransactions}\nإجمالي المبالغ المدفوعة: ${totalPaid.toFixed(2)}`);
    }

    function updateTotalAmount() {
        const total = transactions.reduce((sum, t) => sum + t.amountPaid, 0);
        document.getElementById('totalAmount').innerText = `إجمالي المبالغ المدفوعة: ${total.toFixed(2)}`;
    }

    // Initial display
    displayTransactions();
    updateTotalAmount();
</script>

</body>
</html>
